@using AterStudio.Components.Layout
@using Humanizer

@page "/data/template"
@layout MenuLayout
@inherits PageBase

<PageTitle>
  @Lang(Localizer.Template, Localizer.Manage)
</PageTitle>

@if (!IsLoading)
{
  <FluentSplitter Orientation="Orientation.Horizontal"
                  Panel1Size="260px"
                  Panel1MinSize="200px"
                  Panel2MinSize="60%"
                  Class="w-100"
                  BarSize="5"
                  Style="height:calc(100vh - 56px)">
    <Panel1>
      <FluentStack Orientation="Orientation.Vertical"
                   VerticalGap="0">
        <FluentToolbar Class="w-100">
          <FluentStack Orientation="Orientation.Horizontal"
                       HorizontalAlignment="HorizontalAlignment.SpaceBetween"
                       VerticalAlignment="VerticalAlignment.Center">
            <FluentStack>
              <FluentLabel Typo="Typography.Subject">@Lang(Localizer.Directory)</FluentLabel>
            </FluentStack>

            <FluentStack Orientation="Orientation.Horizontal"
                         HorizontalAlignment="HorizontalAlignment.Right">
              <FluentButton Appearance="Appearance.Stealth"
                            Title="@Lang(Localizer.Add, Localizer.Directory)"
                            OnClick="OpenAddDirectoryDialog"
                            IconStart="@(new Icons.Regular.Size20.Add())" />
              <FluentButton Appearance="Appearance.Stealth"
                            Title="@Lang(Localizer.Delete,Localizer.Directory)"
                            OnClick="DeleteDirectoryAsync"
                            Disabled="SelectedDirectory == null"
                            IconStart="@(new Icons.Regular.Size20.Delete().WithColor(Color.Warning))" />
            </FluentStack>
          </FluentStack>
        </FluentToolbar>

        <FluentNavMenu Class="w-100 list"
                       Expanded="true">
          @foreach (var dir in Directories)
          {
            var active = SelectedDirectory == dir.Name ? "selected" : "";
            <FluentNavLink Class="@($"p-0 {active}")"
                           Style="margin-left:-8px"
                           OnClick="() => SelectDirectory(dir.Name)">
              <FluentLabel Typo="Typography.Subject">@dir.Name</FluentLabel>
            </FluentNavLink>
          }
        </FluentNavMenu>
      </FluentStack>
    </Panel1>
    <Panel2>
      <FluentStack Orientation="Orientation.Vertical"
                   Style="overflow:hidden"
                   VerticalGap="4">

        <FluentToolbar Class="w-100 bg-bottom-2 p-1">
          <FluentStack Orientation="Orientation.Horizontal"
                       Class="p-1"
                       HorizontalAlignment="HorizontalAlignment.SpaceBetween"
                       VerticalAlignment="VerticalAlignment.Center">
            <FluentStack>
              <FluentLabel Typo="Typography.H5">
                @RelativePath
              </FluentLabel>
            </FluentStack>
            <FluentStack HorizontalAlignment="HorizontalAlignment.Right"
                         Orientation="Orientation.Horizontal"
                         VerticalAlignment="VerticalAlignment.Center">
              @* 添加新文件 *@
              <FluentButton Appearance="Appearance.Stealth"
                            OnClick="OpenAddFileDialogAsync"
                            IconStart="@(new Icons.Regular.Size24.Add())"
                            Title="@Lang(Localizer.Add, Localizer.File)" />
            </FluentStack>
          </FluentStack>
        </FluentToolbar>

        <FluentDataGrid Class="w-100"
                        Items="@Files.AsQueryable()"
                        RowSize="DataGridRowSize.Medium"
                        AutoFit="true"
                        @bind-SelectedItem="SelectedFile">
          <PropertyColumn Property="@(f => f.Name)"
                          Title="@Lang(Localizer.File, Localizer.Name)" />

          <TemplateColumn Title="@Lang(Localizer.FileSize)">
            @context.Size?.Bytes().Humanize()
          </TemplateColumn>

          <PropertyColumn Property="@(f => f.LatestTime)"
                          Title="@Lang(Localizer.UpdateTime)" />
          <TemplateColumn Title="@Lang(Localizer.Operate)" Align="Align.Start">
            <FluentStack HorizontalAlignment="HorizontalAlignment.Start">
              <FluentButton Appearance="Appearance.Stealth"
                            OnClick="@(() => OpenEditFileDialog(context))"
                            IconStart="@(new Icons.Regular.Size24.Edit())"
                            Title="@Lang(Localizer.Edit)" />

              <FluentButton Appearance="Appearance.Stealth"
                            OnClick="@(() => DeleteFile(context))"
                            IconStart="@(new Icons.Regular.Size24.Delete().WithColor(Color.Warning))"
                            Title="@Lang(Localizer.Delete, Localizer.File)" />
            </FluentStack>
          </TemplateColumn>
        </FluentDataGrid>
      </FluentStack>
    </Panel2>
  </FluentSplitter>
}

<FluentDialog @bind-Hidden="DialogHidden"
              Style="--dialog-width:400px"
              Modal="true">
  <FluentDialogHeader ShowDismiss="true">
    <FluentLabel Typo="Typography.PaneHeader">
      @Lang(Localizer.Add, Localizer.Directory)
    </FluentLabel>
  </FluentDialogHeader>
  <FluentBodyContent>
    <FluentTextField @bind-Value="NewDirectoryName"
                     Class="w-100"
                     Required
                     Label="@Lang(Localizer.Directory,Localizer.Name)"
                     Maxlength="50">
    </FluentTextField>
  </FluentBodyContent>
  <FluentDialogFooter>
    <FluentStack Orientation=" Orientation.Horizontal"
                 HorizontalAlignment="HorizontalAlignment.Right">
      <FluentButton Appearance="Appearance.Accent"
                    OnClick="()=>AddDirectory()">
        @Lang(Localizer.Add)
      </FluentButton>
      <FluentButton Appearance="Appearance.Neutral"
                    OnClick="() => DialogHidden=true">
        @Lang(Localizer.Cancel)
      </FluentButton>
    </FluentStack>


  </FluentDialogFooter>
</FluentDialog>