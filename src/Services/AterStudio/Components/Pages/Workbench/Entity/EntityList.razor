@page "/workbench/entity"
@page "/workbench/entity/{id}"
@inherits PageBase
@layout Layout


<FluentStack Orientation="Orientation.Vertical" VerticalGap="4">
    @* top Toolbar *@
    <FluentToolbar Orientation="Orientation.Horizontal" Class="w-100 p-2 bg-3">
        <FluentStack Orientation="Orientation.Horizontal"
                     HorizontalAlignment="HorizontalAlignment.SpaceBetween">
            <FluentLabel Typo="Typography.PaneHeader">
                @ProjectContext.ProjectName
            </FluentLabel>
            <FluentStack Orientation="Orientation.Horizontal"
                         HorizontalGap="4"
                         Class="pe-2"
                         HorizontalAlignment="HorizontalAlignment.End">
                <FluentButton Appearance="Appearance.Stealth"
                              Title="refresh"
                              IconStart="@(new Icons.Regular.Size24.ArrowClockwise())"></FluentButton>
                <FluentButton Appearance="Appearance.Stealth"
                              Title="clean solution obj & bin files"
                              IconStart="@(new Icons.Regular.Size24.Broom().WithColor(Color.Success))"></FluentButton>

                <FluentCounterBadge Appearance="Appearance.Accent"
                                    Count="@Services.Count">
                    <FluentButton Appearance="Appearance.Stealth"
                                  Title="services"
                                  IconStart="@(new Icons.Regular.Size24.Connected())">
                    </FluentButton>
                </FluentCounterBadge>

            </FluentStack>
        </FluentStack>
    </FluentToolbar>

    <FluentSplitter Orientation="Orientation.Horizontal"
                    Panel1Size="200px"
                    Panel1MinSize="200px"
                    Panel2MinSize="60%"
                    Class="w-100" Style="height:calc(100vh - 108px)">
        <Panel1>
            @* modules *@
            <FluentStack Orientation="Orientation.Vertical"
                         Class="px-1"
                         VerticalGap="0">
                <FluentToolbar Orientation="Orientation.Horizontal"
                               Class="w-100 bg-1">
                    <FluentStack Orientation="Orientation.Horizontal"
                                 VerticalAlignment="VerticalAlignment.Center"
                                 HorizontalAlignment="HorizontalAlignment.SpaceBetween"
                                 HorizontalGap="0">
                        <FluentStack>
                            <FluentLabel Typo="Typography.Subject">
                                @Lang(Localizer.Modules)
                            </FluentLabel>
                        </FluentStack>

                        <FluentStack Orientation="Orientation.Horizontal"
                                     HorizontalAlignment="HorizontalAlignment.Right">

                            <FluentButton Appearance="Appearance.Stealth"
                                          Title=@Lang(Localizer.Add, Localizer.Modules)
                                          IconStart="@(new Icons.Regular.Size20.Add())">
                            </FluentButton>

                            <FluentButton Appearance="Appearance.Stealth"
                                          Title=@Lang(Localizer.Delete, Localizer.Modules)
                                          IconStart="@(new Icons.Regular.Size20.Delete().WithColor(Color.Error))">
                            </FluentButton>
                        </FluentStack>

                    </FluentStack>
                </FluentToolbar>

                <FluentListbox TOption="string"
                               @bind-Value=SelectedModule
                               Width="100%"
                               SelectedOptionChanged="FilterEntityFiles"
                               Class="w-100">
                    <FluentOption Selected=true>@Lang(Localizer.All)</FluentOption>
                    @if (Modules.Count > 0)
                    {
                        foreach (var module in Modules)
                        {
                            <FluentOption Value=@module.Name>@module.Name</FluentOption>
                        }
                    }
                </FluentListbox>
            </FluentStack>
        </Panel1>

        <Panel2>

            @* entity list *@
            <FluentStack Orientation="Orientation.Vertical" Style="overflow:hidden" Class="p-1">

                <FluentDataGrid @ref="grid"
                                Class="w-100"
                                Items="@FilteredEntityFiles"
                                ResizableColumns=true
                                RowSize="@DataGridRowSize.Medium"
                                Pagination="@pagination"
                                AutoFit="true">

                    <TemplateColumn Title="@Lang(Localizer.Entity)"
                                    Sortable="true">
                        <FluentStack Orientation="Orientation.Horizontal"
                                     VerticalAlignment="VerticalAlignment.Center">
                            <FluentButton Appearance="Appearance.Lightweight"
                                          OnClick="@(_ => EditCodeAsync(context))">
                                @context.Name
                            </FluentButton>
                        </FluentStack>

                    </TemplateColumn>
                    <PropertyColumn Property="@(c => c.Comment)"
                                    Title="@Lang(Localizer.Description)"
                                    Width="200px" />

                    <TemplateColumn Title="@Lang(Localizer.Operate)" Align="Align.Start">
                        <FluentStack HorizontalAlignment="HorizontalAlignment.Start">
                            <FluentButton Title="生成代码"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.AddSquare())" />
                            <FluentButton Title="编辑DTO"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.Code())" />
                            <FluentButton Title="Manager"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.CodeBlock())" />
                            <FluentButton Title="API"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.Connected())" />
                        </FluentStack>
                    </TemplateColumn>
                </FluentDataGrid>
                <FluentPaginator State="@pagination" Style="width:100%" />
            </FluentStack>
        </Panel2>
    </FluentSplitter>
</FluentStack>

<FluentDialog @ref="_dialog"
              @bind-Hidden="@Hidden"
              Style="--dialog-width:800px"
              Modal="true">
    <FluentDialogHeader ShowDismiss="true">
        <FluentLabel Typo="Typography.PaneHeader">编辑实体<code>@entityName</code>文件</FluentLabel>
        <FluentLabel Typo="Typography.Subject" Color="Color.Accent">
            编辑实体文件的代码内容
        </FluentLabel>
    </FluentDialogHeader>
    <StandaloneCodeEditor CssClass="vh-75" ConstructionOptions="SetCodeEditorOptions" />
    <FluentDialogFooter Style="text-align:end">
        <FluentStack HorizontalAlignment="HorizontalAlignment.End">
            <FluentButton OnClick="_dialog.Hide">关闭</FluentButton>
            <FluentButton Appearance="Appearance.Accent" OnClick="_dialog.Hide">保存</FluentButton>
        </FluentStack>
    </FluentDialogFooter>
</FluentDialog>
