@using StudioMod.Models.GenActionDtos
@using Entity.StudioMod
@inherits PageBase
@implements IDialogContentComponent

<FluentDialogHeader ShowDismiss="false">
  <FluentLabel Typo="Typography.PaneHeader">@((Model.Id == Guid.Empty) ? Lang(Localizer.Add, Localizer.Task) : Lang(Localizer.Edit, Localizer.Task))</FluentLabel>
</FluentDialogHeader>
<FluentBodyContent>
  <EditForm EditContext="editContext">
    <DataAnnotationsValidator />
    <FluentValidationSummary />
    <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
      <FluentTextField @bind-Value="Model.Name"
                       Placeholder="@Lang(Localizer.Task, Localizer.Name)"
                       Class="w-100"
                       Required
                       Maxlength="40" />
      <FluentTextField @bind-Value="Model.Description"
                       Placeholder="@Lang(Localizer.Description)"
                       Class="w-100"
                       Maxlength="200" />

      <FluentSelect TOption="GenSourceType"
                    Items="@SourceTypes"
                    Placeholder="@Lang(Localizer.SourceType)"
                    Class="w-100" />
    </FluentStack>
  </EditForm>
</FluentBodyContent>
<FluentDialogFooter>
  <FluentButton Appearance="Appearance.Accent"
                OnClick="SaveAsync">
    @Lang(Localizer.Confirm)
  </FluentButton>
  <FluentButton Appearance="Appearance.Neutral"
                OnClick="CancelAsync">
    @Lang(Localizer.Cancel)
  </FluentButton>
</FluentDialogFooter>

@code {
  [CascadingParameter] FluentDialog Dialog { get; set; } = null!;
  EditContext? editContext;

  GenAction Model { get; set; } = new() { Name = string.Empty };
  IEnumerable<GenSourceType> SourceTypes { get; set; } = Enum.GetValues<GenSourceType>();

  protected override void OnInitialized()
  {
    editContext = new EditContext(Model);
  }

  private async Task SaveAsync()
  {
    if (!editContext!.Validate())
    {
      ToastService.ShowError(Lang(Localizer.FormValidFailed));
      return;
    }
    await Dialog.CloseAsync(Model);
  }
  private async Task CancelAsync()
  {
    await Dialog.CancelAsync();
  }
}