@page "/workbench/entity/{id}"
@inherits PageBase
@layout Layout


<FluentStack Orientation="Orientation.Vertical" VerticalGap="4">
    @* top Toolbar *@
    <FluentToolbar Orientation="Orientation.Horizontal" Class="w-100 p-2">
        <FluentStack Orientation="Orientation.Horizontal"
                     HorizontalAlignment="HorizontalAlignment.SpaceBetween">
            <FluentLabel Typo="Typography.PaneHeader">
                @ProjectContext.ProjectName
            </FluentLabel>
            <FluentStack Orientation="Orientation.Horizontal"
                         HorizontalGap="4"
                         Class="pe-2"
                         HorizontalAlignment="HorizontalAlignment.End">
                <FluentButton Appearance="Appearance.Stealth"
                              Title="refresh"
                              IconStart="@(new Icons.Regular.Size24.ArrowSync())"></FluentButton>
                <FluentButton Appearance="Appearance.Stealth"
                              Title="clean solution obj & bin files"
                              IconStart="@(new Icons.Regular.Size24.Delete().WithColor(Color.Success))"></FluentButton>

                <FluentCounterBadge Appearance="Appearance.Accent"
                                    Count="@Services.Count">
                    <FluentButton Appearance="Appearance.Stealth"
                                  Title="services"
                                  IconStart="@(new Icons.Regular.Size24.Connected())">

                    </FluentButton>
                </FluentCounterBadge>

            </FluentStack>
        </FluentStack>
    </FluentToolbar>

    <FluentSplitter Orientation="Orientation.Horizontal"
                    Panel1Size="200px"
                    Panel1MinSize="200px"
                    Panel2MinSize="60%"
                    Class="w-100" Style="height:auto">
        <Panel1>
            @* modules *@
            <FluentStack Orientation="Orientation.Vertical" Class="px-1">
                <FluentLabel Typo="Typography.Subject">
                    @Lang(Localizer.Modules, Localizer.Filter)
                </FluentLabel>
                <FluentListbox TOption="string"
                               @bind-Value=SelectedModule
                               Width="100%"
                               Class="w-100">
                    <FluentOption Selected=true>@Lang(Localizer.All)</FluentOption>
                    @if (Modules.Count > 0)
                    {
                        foreach (var module in Modules)
                        {
                            <FluentOption Value=@module.Name>@module.Name</FluentOption>
                        }
                    }
                </FluentListbox>
            </FluentStack>

            <h5>
                @SelectedModule
            </h5>
        </Panel1>

        <Panel2>
            @* entity list *@
            <FluentStack Orientation="Orientation.Vertical" Style="overflow:hidden">
                <FluentDataGrid @ref="grid"
                                Items="@EntityFiles"
                                ResizableColumns=true
                                RowSize="@DataGridRowSize.Medium"
                                Pagination="@pagination"
                                AutoFit="true"
                                HeaderCellAsButtonWithMenu="true">
                    <TemplateColumn Title="@Lang(Localizer.Entity)" Sortable="true">
                        <FluentStack Orientation="Orientation.Horizontal"
                                     VerticalAlignment="VerticalAlignment.Center">
                            <FluentButton Appearance="Appearance.Lightweight"
                                          OnClick="@(_ => EditCodeAsync(context))">
                                @context.Name
                            </FluentButton>
                        </FluentStack>

                    </TemplateColumn>
                    <PropertyColumn Property="@(c => c.Comment)"
                                    Sortable="true"
                                    Title="@Lang(Localizer.Description)"
                                    Width="200px" />

                    <TemplateColumn Title="@Lang(Localizer.Operate)" Align="Align.Start">
                        <FluentStack HorizontalAlignment="HorizontalAlignment.Start">
                            <FluentButton Title="生成代码"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.AddSquare())" />
                            <FluentButton Title="编辑DTO"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.Code())" />
                            <FluentButton Title="Manager"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.CodeBlock())" />
                            <FluentButton Title="API"
                                          Appearance="Appearance.Stealth"
                                          IconEnd="@(new Icons.Regular.Size20.Connected())" />
                        </FluentStack>
                    </TemplateColumn>
                </FluentDataGrid>
            </FluentStack>
        </Panel2>
    </FluentSplitter>
</FluentStack>

<FluentDialog @ref="_dialog"
              @bind-Hidden="@Hidden"
              Style="--dialog-width:800px"
              Modal="true">
    <FluentDialogHeader ShowDismiss="true">
        <FluentLabel Typo="Typography.PaneHeader">编辑实体<code>@entityName</code>文件</FluentLabel>
        <FluentLabel Typo="Typography.Subject" Color="Color.Accent">
            编辑实体文件的代码内容
        </FluentLabel>
    </FluentDialogHeader>
    <StandaloneCodeEditor CssClass="vh-75" ConstructionOptions="SetCodeEditorOptions" />
    <FluentDialogFooter Style="text-align:end">
        <FluentStack HorizontalAlignment="HorizontalAlignment.End">
            <FluentButton OnClick="_dialog.Hide">关闭</FluentButton>
            <FluentButton Appearance="Appearance.Accent" OnClick="_dialog.Hide">保存</FluentButton>
        </FluentStack>
    </FluentDialogFooter>
</FluentDialog>
