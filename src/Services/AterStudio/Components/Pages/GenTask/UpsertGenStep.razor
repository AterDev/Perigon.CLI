@inherits PageBase
@implements IDialogContentComponent

<FluentDialogHeader ShowDismiss="false">
  <FluentLabel Typo="Typography.PaneHeader">@((Model.Id == Guid.Empty) ? Lang(Localizer.Add, Localizer.Step) : Lang(Localizer.Edit, Localizer.Step))</FluentLabel>
</FluentDialogHeader>
<FluentBodyContent>
  <EditForm EditContext="editContext">
    <DataAnnotationsValidator />
    <FluentValidationSummary />
    <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
      <FluentTextField @bind-Value="Model.Name"
                       Placeholder="@Lang(Localizer.Step, Localizer.Name)"
                       Class="w-100"
                       Required
                       Maxlength="100" />
      <FluentTextField @bind-Value="Model.TemplatePath"
                       Placeholder="@Lang(Localizer.Template, Localizer.Path)"
                       Class="w-100"
                       Maxlength="400" />
      <FluentTextField @bind-Value="Model.OutputPath"
                       Placeholder="@Lang(Localizer.OutputPath, Localizer.Path)"
                       Class="w-100"
                       Maxlength="400" />
      @*             <FluentTextField @bind-Value="Model.FileType"
                             Placeholder="@Lang(Localizer.FileType)"
                             Class="w-100"
                             Maxlength="20" /> *@
    </FluentStack>
  </EditForm>
</FluentBodyContent>
<FluentDialogFooter>
  <FluentButton Appearance="Appearance.Accent"
                OnClick="SaveAsync">
    @Lang(Localizer.Confirm)
  </FluentButton>
  <FluentButton Appearance="Appearance.Neutral"
                OnClick="CancelAsync">
    @Lang(Localizer.Cancel)
  </FluentButton>
</FluentDialogFooter>

@code {
  [CascadingParameter] FluentDialog Dialog { get; set; } = null!;
  EditContext? editContext;
  GenStep Model { get; set; } = new() { Name = string.Empty };

  protected override void OnInitialized()
  {
    editContext = new EditContext(Model);
  }

  private async Task SaveAsync()
  {
    if (!editContext!.Validate())
    {
      ToastService.ShowError(Lang(Localizer.FormValidFailed));
      return;
    }
    await Dialog.CloseAsync(Model);
  }
  private async Task CancelAsync()
  {
    await Dialog.CancelAsync();
  }
}